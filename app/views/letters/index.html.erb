<div class="max-w-4xl mx-auto py-12 px-6">
  
  <div class="mb-12 border-b border-slate-200 pb-6">
    <h1 class="font-['Poppins'] text-3xl md:text-4xl font-bold text-slate-900 tracking-tight">
      Personal Mailbox.
    </h1>
    <p class="text-slate-400 text-xs mt-2 font-['Space_Grotesk'] tracking-widest uppercase">
      Private Correspondence / <%= @letters.count %> Letters
    </p>
  </div>

  <div class="space-y-6">
    <% @letters.each do |letter| %>
      
      <details class="group bg-white rounded-2xl border border-slate-100 shadow-sm open:shadow-lg open:border-indigo-100 transition-all duration-300 overflow-hidden">
        
        <summary class="list-none cursor-pointer p-6 flex items-start gap-4 hover:bg-slate-50 transition-colors relative">
          
          <div class="absolute right-6 top-6 text-slate-300 group-open:rotate-180 transition-transform duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" /></svg>
          </div>

          <div class="shrink-0 w-12 h-12 rounded-full bg-indigo-50 text-indigo-600 border border-indigo-100 flex items-center justify-center font-['Poppins'] font-bold text-lg">
            <%= letter.sender.username.first.upcase %>
          </div>

          <div class="flex-1 pr-8">
            <div class="flex items-center gap-2 mb-1">
              <span class="font-['Poppins'] font-bold text-slate-900">
                @<%= letter.sender.username %>
              </span>
              <span class="text-xs text-slate-400 font-['Inter']">
                sent a letter via
              </span>
              <%= link_to truncate(letter.fragment.title, length: 20), fragment_path(letter.fragment), class: "text-xs font-bold text-indigo-500 hover:underline decoration-1 underline-offset-2", title: "Go to fragment" %>
            </div>
            
            <h3 class="text-sm font-bold text-slate-600 group-open:text-indigo-600 transition-colors mb-1">
              <%= letter.subject.presence || "(No Subject)" %>
            </h3>
            
            <span class="text-[10px] text-slate-300 font-['Space_Grotesk'] tracking-widest uppercase">
              Received <%= time_ago_in_words(letter.created_at) %> ago
            </span>
          </div>
        </summary>

        <div class="px-8 pb-8 pt-2 bg-slate-50/50 border-t border-slate-100">
          <div class="bg-white p-6 md:p-8 rounded-xl border border-slate-100 shadow-sm">
            <div class="prose prose-slate prose-sm max-w-none font-['Inter'] leading-relaxed whitespace-pre-wrap text-slate-700">
              <%= letter.body %>
            </div>
            
            <div class="mt-8 pt-6 border-t border-slate-50 flex justify-end">
               <div class="text-right">
                 <p class="text-[10px] text-slate-400 font-['Space_Grotesk'] uppercase tracking-widest">Sincerely,</p>
                 <p class="font-['Poppins'] font-bold text-slate-800 text-sm mt-1">@<%= letter.sender.username %></p>
               </div>
            </div>
          </div>
        </div>

      </details>

    <% end %>

    <% if @letters.empty? %>
      <div class="py-24 text-center opacity-40">
        <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-400">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg>
        </div>
        <p class="font-['Poppins'] text-slate-500">Your mailbox is empty.</p>
        <p class="text-xs text-slate-400 mt-1">Wait for someone to write to you.</p>
      </div>
    <% end %>
  </div>
</div>