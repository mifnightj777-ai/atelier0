<div class="min-h-screen bg-slate-50/50 pb-20">

  <%# --- 1. ZINE専用のヘッダー（タイトルが主役） --- %>
  <div class="relative w-full h-[35vh] md:h-[45vh] overflow-hidden bg-slate-900 flex items-center justify-center">
    
    <%# 背景：このZINEの中にある最初の画像のぼかし %>
    <% if @fragments.present? && @fragments.first&.image&.attached? %>
      <%= image_tag @fragments.first.image, class: "absolute inset-0 w-full h-full object-cover opacity-30 blur-2xl scale-110" %>
    <% else %>
      <div class="absolute inset-0 bg-gradient-to-br from-slate-800 to-slate-900"></div>
    <% end %>

    <div class="relative z-10 text-center px-4 max-w-4xl mx-auto">
      <%# 公開設定のバッジ %>
      <div class="mb-6">
        <% if @collection.private_view? %>
          <span class="px-3 py-1 rounded-full bg-black/40 text-white text-[10px] font-bold uppercase tracking-widest border border-white/20 backdrop-blur-sm">Private ZINE</span>
        <% elsif @collection.teammates_view? %>
          <span class="px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-200 text-[10px] font-bold uppercase tracking-widest border border-emerald-500/30 backdrop-blur-sm">Team ZINE</span>
        <% end %>
      </div>

      <%# ZINEのタイトル %>
      <h1 class="text-4xl md:text-7xl font-['Poppins'] font-bold text-white mb-4 tracking-tight drop-shadow-2xl">
        <%= @collection.title %>
      </h1>
      
      <%# クリエイター情報（控えめに表示 / アバター問題は永久対策済） %>
      <div class="mt-8 flex items-center justify-center gap-2.5 opacity-90">
        <div class="w-7 h-7 rounded-full overflow-hidden border border-white/30 shadow-sm">
          <% if @collection.user&.avatar&.attached? %>
            <%= image_tag @collection.user.avatar, class: "w-full h-full object-cover" %>
          <% else %>
            <div class="w-full h-full bg-white/20 flex items-center justify-center text-white font-bold text-[10px]">
              <%= @collection.user&.username&.first&.upcase || "?" %>
            </div>
          <% end %>
        </div>
        <span class="text-white/80 text-[11px] font-bold tracking-wider uppercase">
          Curated by @<%= @collection.user&.username %>
        </span>
      </div>
    </div>
  </div>

  <%# --- 2. 管理アクション（本人のみ） --- %>
  <% if user_signed_in? && current_user.id == @collection.user_id %>
    <div class="max-w-7xl mx-auto px-4 -mt-6 relative z-20 flex justify-end gap-3">
      <%= link_to edit_collection_path(@collection), class: "px-5 py-2.5 bg-white rounded-full text-xs font-bold text-slate-700 shadow-xl border border-slate-100 hover:text-indigo-600 transition-all flex items-center gap-2" do %>
        <span>Edit ZINE</span>
      <% end %>
      <%= link_to new_collection_collection_item_path(@collection), class: "px-5 py-2.5 bg-slate-900 rounded-full text-xs font-bold text-white shadow-xl hover:bg-indigo-600 transition-all flex items-center gap-2" do %>
        <span>Add Fragments</span>
      <% end %>
    </div>
  <% end %>

  <%# --- 3. Fragments グリッド（中身） --- %>
  <div class="max-w-7xl mx-auto px-4 mt-16">
    <% if @fragments.present? && @fragments.any? %>
      <div class="columns-2 md:columns-3 lg:columns-4 gap-6 space-y-6">
        <% @fragments.each do |fragment| %>
          <div class="break-inside-avoid group relative">
            <div class="relative rounded-2xl overflow-hidden bg-white shadow-sm border border-slate-100 transition-all duration-300 group-hover:-translate-y-1 group-hover:shadow-xl">
              <%= link_to "", fragment_path(fragment), class: "absolute inset-0 z-10" %>
              
              <% if fragment.image.attached? %>
                <%= image_tag fragment.image, class: "w-full h-auto object-cover" %>
              <% else %>
                <div class="aspect-square bg-slate-50 flex items-center justify-center text-slate-300 text-xs">No Image</div>
              <% end %>

              <%# ホバー時タイトル %>
              <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity p-4 flex flex-col justify-end pointer-events-none">
                <p class="text-white text-[10px] font-bold uppercase tracking-widest opacity-70 mb-1">Fragment</p>
                <h3 class="text-white text-sm font-bold truncate"><%= fragment.title.presence || "Untitled" %></h3>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-32 bg-white/50 rounded-3xl border border-dashed border-slate-200">
        <p class="font-bold text-slate-400 text-xs uppercase tracking-widest">This ZINE has no visible fragments yet.</p>
      </div>
    <% end %>
  </div>
</div>