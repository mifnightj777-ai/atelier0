<%= turbo_frame_tag dom_id(memo) do %>

  <%# デザイン設定: 手書きなら白背景 %>
  <% bg_class = memo.handwriting_data.present? ? "bg-white border-2 border-slate-100" : (memo.color.presence || 'memo-yellow border-l-4 border-slate-200/50') %>

  <div class="group relative <%= bg_class %> p-4 shadow-sm hover:shadow-md transition-all duration-500 mb-4 rounded-2xl flex flex-col min-h-[140px]">
    
    <%# --- メインコンテンツ --- %>
    <div class="flex-1 w-full flex items-center justify-center overflow-hidden">
      
      <% if memo.handwriting_data.present? %>
        <%# 手書きメモ: 画像データは src属性にあるので、data属性には入れなくてOK %>
        <button type="button" 
                data-action="click->handwriting#edit"
                data-handwriting-url-param="<%= idea_memo_path(memo.idea, memo) %>"
                class="w-full h-full flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity"
                title="Tap to continue drawing">
          <img src="<%= memo.handwriting_data %>" class="max-w-full max-h-[100px] w-auto object-contain mix-blend-multiply">
        </button>
      
      <% elsif memo.image.attached? %>
        <%= image_tag memo.image, class: "max-w-full max-h-[100px] w-auto object-contain drop-shadow-sm mix-blend-multiply" %>
      
      <% else %>
        <p class="w-full text-xs md:text-sm text-slate-700 font-['Inter'] whitespace-pre-wrap leading-relaxed self-start">
          <%= memo.content %>
        </p>
      <% end %>

    </div>

    <%# --- 操作ボタン --- %>
    <div class="absolute top-2 right-2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
      
      <%# テキストメモのみ編集ボタンを表示 %>
      <% unless memo.handwriting_data.present? || memo.image.attached? %>
        <%= link_to edit_idea_memo_path(memo.idea, memo), class: "text-slate-400 hover:text-indigo-600 p-1.5 bg-white/60 rounded-full transition-colors backdrop-blur-sm" do %>
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
        <% end %>
      <% end %>

      <%= button_to idea_memo_path(memo.idea, memo), method: :delete, class: "text-slate-400 hover:text-red-500 p-1.5 bg-white/60 rounded-full transition-colors backdrop-blur-sm" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      <% end %>
    </div>
    
    <div class="mt-2 text-[9px] text-slate-400 font-medium text-right w-full">
      <%= time_ago_in_words(memo.created_at) %> ago
    </div>
  </div>
<% end %>