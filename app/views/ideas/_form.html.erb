<div class="min-h-screen flex flex-col relative bg-[#F9FAFB]" data-controller="focus-sound drawer">

  <div class="fixed inset-0 pointer-events-none z-0">
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[80vw] h-[50vh] bg-indigo-50/50 rounded-full blur-[100px]"></div>
  </div>

  <div class="fixed top-6 left-0 right-0 z-40 px-6 flex justify-center items-center pointer-events-none">
    
    <div class="pointer-events-auto bg-white/90 backdrop-blur-xl border border-white/50 shadow-[0_8px_30px_rgb(0,0,0,0.04)] rounded-full px-2 py-2 flex items-center gap-1 md:gap-2 transition-all hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)]">

      <%= link_to root_path, class: "w-10 h-10 rounded-full flex items-center justify-center text-slate-400 hover:bg-slate-100 hover:text-slate-600 transition-colors", title: "Exit" do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
      <% end %>

      <div class="w-px h-6 bg-slate-200 mx-1"></div>

      <div class="flex items-center gap-1">
        <button type="button" data-action="click->focus-sound#toggle" data-focus-sound-target="button" data-sound-url="https://actions.google.com/sounds/v1/weather/rain_heavy_loud.ogg" class="w-10 h-10 rounded-full flex items-center justify-center text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 transition-all" title="Rain">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" /><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 18.75l-1.5 3m6-3l-1.5 3" /></svg>
        </button>
        <button type="button" data-action="click->focus-sound#toggle" data-focus-sound-target="button" data-sound-url="https://actions.google.com/sounds/v1/ambiences/fire.ogg" class="w-10 h-10 rounded-full flex items-center justify-center text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 transition-all" title="Fire">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 00.495-7.467 5.99 5.99 0 00-1.925 3.546 5.974 5.974 0 01-2.133-1.001A3.75 3.75 0 0012 18z" /></svg>
        </button>
        <button type="button" data-action="click->focus-sound#toggle" data-focus-sound-target="button" data-sound-url="https://actions.google.com/sounds/v1/ambiences/coffee_shop.ogg" class="w-10 h-10 rounded-full flex items-center justify-center text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 transition-all" title="Cafe">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17 8h1a4 4 0 1 1 0 8h-1" /><path stroke-linecap="round" stroke-linejoin="round" d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V8z" /><path stroke-linecap="round" stroke-linejoin="round" d="M6 1v3" /><path stroke-linecap="round" stroke-linejoin="round" d="M10 1v3" /><path stroke-linecap="round" stroke-linejoin="round" d="M14 1v3" />
          </svg>
        </button>
      </div>

      <div class="w-px h-6 bg-slate-200 mx-1"></div>

      <div class="flex items-center gap-1 px-2" data-controller="focus-timer">
         <button data-action="click->focus-timer#toggle" class="flex items-center gap-2 text-sm font-['Space_Grotesk'] font-bold text-slate-500 hover:text-indigo-600 transition-colors tabular-nums min-w-[60px] justify-center" title="Start/Stop">
           <span data-focus-timer-target="display">25:00</span>
         </button>
         <button data-action="click->focus-timer#reset" class="text-slate-300 hover:text-red-400 p-1" title="Reset">
           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
         </button>
      </div>

      <div class="w-px h-6 bg-slate-200 mx-1"></div>

      <button type="button" data-action="click->drawer#toggle" class="w-10 h-10 rounded-full flex items-center justify-center text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 transition-all relative" title="Memo Desk">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
        </svg>
        </button>

      <div class="pl-2">
        <label for="submit-btn" class="cursor-pointer bg-slate-900 text-white font-['Poppins'] font-bold text-xs px-5 py-2.5 rounded-full hover:bg-indigo-600 transition-all flex items-center gap-2 shadow-md hover:shadow-lg">
          <span>SAVE</span>
        </label>
      </div>

    </div>
  </div>

  <div class="flex-1 flex flex-col items-center pt-32 pb-20 px-6 overflow-y-auto relative z-10">
    
    <%= form_with(model: idea, class: "w-full max-w-3xl animate-fade-in-up", data: { turbo: false }) do |form| %>
      
      <%= form.submit "", id: "submit-btn", class: "hidden" %>

      <div class="space-y-4 text-center md:text-left">
        
        <div>
          <%= form.text_field :title, placeholder: "Untitled Idea", class: "w-full bg-transparent border-none p-0 text-5xl md:text-6xl font-['Poppins'] font-bold text-slate-900 placeholder-slate-200 focus:ring-0 outline-none text-center md:text-left transition-colors leading-tight tracking-tight" %>
        </div>

        <div class="flex justify-center md:justify-start gap-6 items-center">
           <div class="h-px w-8 bg-slate-200"></div> <label class="cursor-pointer flex items-center gap-2 group">
             <%= form.radio_button :visibility, :private_view, class: "peer sr-only" %>
             <div class="w-2 h-2 rounded-full bg-slate-200 peer-checked:bg-slate-800 transition-colors"></div>
             <span class="text-xs font-['Inter'] font-medium uppercase tracking-widest text-slate-400 peer-checked:text-slate-800 transition-colors">Private</span>
           </label>

           <label class="cursor-pointer flex items-center gap-2 group">
             <%= form.radio_button :visibility, :teammates_view, class: "peer sr-only" %>
             <div class="w-2 h-2 rounded-full bg-slate-200 peer-checked:bg-amber-500 transition-colors"></div>
             <span class="text-xs font-['Inter'] font-medium uppercase tracking-widest text-slate-400 peer-checked:text-amber-600 transition-colors">Teammates</span>
           </label>
        </div>

        <div class="pt-8">
          <%= form.text_area :description, rows: 20, placeholder: "Start writing...", class: "w-full bg-transparent border-none p-0 text-lg md:text-xl font-['Inter'] text-slate-600 placeholder-slate-200 focus:ring-0 outline-none resize-none leading-relaxed tracking-wide" %>
        </div>
      </div>
    <% end %>
  </div>

  <div data-drawer-target="panel" class="fixed top-0 right-0 bottom-0 w-96 bg-white/95 backdrop-blur-xl border-l border-slate-100 shadow-2xl transform translate-x-full transition-transform duration-300 ease-[cubic-bezier(0.23,1,0.32,1)] z-50 flex flex-col">
    
    <div class="px-6 py-5 border-b border-slate-100 flex justify-between items-center">
      <div class="flex items-center gap-2 text-slate-900">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" /></svg>
        <span class="font-['Poppins'] font-bold text-xs tracking-widest uppercase">Memo Desk</span>
      </div>
      <button data-action="click->drawer#toggle" class="text-slate-400 hover:text-indigo-600 transition-colors p-1 hover:bg-slate-50 rounded-full">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
      </button>
    </div>

    <div class="flex-1 overflow-y-auto p-6 space-y-4 bg-slate-50/50">
      <% if idea.persisted? %>
        <div class="relative group">
          <%= form_with(model: [idea, Memo.new], data: { turbo: true }, class: "relative") do |f| %>
            <%= f.text_area :content, rows: 3, placeholder: "Type a quick note...", class: "w-full bg-white border border-slate-200 rounded-xl p-4 text-sm font-['Inter'] text-slate-700 placeholder-slate-300 focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 resize-none shadow-sm transition-shadow group-hover:shadow-md" %>
            <button type="submit" class="absolute bottom-3 right-3 text-indigo-400 hover:text-indigo-600 hover:bg-indigo-50 p-1.5 rounded-full transition-all" title="Add Memo">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M3.105 2.289a.75.75 0 00-.826.95l1.414 4.925A1.5 1.5 0 004.836 9.25h6.29a.75.75 0 010 1.5H4.836a1.5 1.5 0 00-1.144 1.086l-1.414 4.925a.75.75 0 00.826.95 28.896 28.896 0 0015.293-7.154.75.75 0 000-1.115A28.897 28.897 0 003.105 2.289z" /></svg>
            </button>
          <% end %>
        </div>
        
        <div id="memos_list" class="space-y-3 pb-10">
          <%= render idea.memos.order(created_at: :desc) %>
        </div>
      <% else %>
        <div class="flex flex-col items-center justify-center h-full text-center opacity-50 px-6">
           <div class="w-12 h-12 bg-slate-100 text-slate-400 rounded-full flex items-center justify-center mb-3">
             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" /></svg>
           </div>
           <p class="text-slate-500 text-xs font-['Poppins'] font-bold">LOCKED</p>
           <p class="text-slate-400 text-xs mt-1">Please save your idea first<br>to unlock the Memo Desk.</p>
        </div>
      <% end %>
    </div>
  </div>

</div>

<style>
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
  .animate-fade-in-up { animation: fadeInUp 0.8s ease-out forwards; }
  .animate-fade-in-down { animation: fadeInDown 0.8s ease-out forwards; }
</style>