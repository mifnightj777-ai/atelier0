<div class="max-w-2xl mx-auto px-6 py-0">

  <%= form_with(model: fragment, class: "block") do |form| %>
    
    <%= form.hidden_field :prompt_id %>
    <%= form.hidden_field :parent_id %>

  <div class="text-center mb-12">
    <% if fragment.prompt %>
      <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-indigo-50 rounded-full text-indigo-600 text-xs font-['Space_Grotesk'] font-bold uppercase tracking-widest mb-4">
        <span class="w-1.5 h-1.5 rounded-full bg-indigo-500 animate-pulse"></span>
        Daily Prompt
      </div>
      <h2 class="text-3xl font-['Poppins'] font-bold text-slate-900 leading-tight">
        "<%= fragment.prompt.content %>"
      </h2>
    <% end %>
  </div>

  <div class="space-y-10 mb-12">
      <div>
          <%= form.label :title, "TITLE", class: "block text-xs font-['Space_Grotesk'] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-2" %>
          <%= form.text_field :title, placeholder: "Untitled Fragment", class: "w-full text-left bg-transparent border-b-2 border-transparent hover:border-slate-100 focus:border-slate-900 px-4 py-2 text-3xl font-['Poppins'] font-bold text-slate-900 placeholder-slate-200 outline-none transition-colors" %>
      </div>

      <div>
          <%= form.label :description, "STORY / MEMO", class: "block text-xs font-['Space_Grotesk'] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-2" %>
          <%= form.text_area :description, rows: 4, placeholder: "Add a caption or story...", class: "w-full bg-slate-50 border-none rounded-2xl px-6 py-4 text-sm font-['Inter'] text-slate-700 placeholder-slate-400 focus:ring-2 focus:ring-slate-200 outline-none resize-none leading-relaxed" %>
      </div>
  </div>

  <div class="mb-5 space-y-3" data-controller="image-preview">
      <label class="block text-xs font-['Space_Grotesk'] font-bold text-slate-400 uppercase tracking-widest ml-1">ARTWORK</label>
      
      <div class="border-2 border-dashed border-slate-200 rounded-2xl p-4 text-center cursor-pointer hover:border-indigo-300 hover:bg-indigo-50/30 transition-all group relative overflow-hidden min-h-[240px] flex items-center justify-center">
        
        <%= form.file_field :image, 
            class: "absolute inset-0 w-full h-full opacity-0 cursor-pointer z-30",
            data: { 
              image_preview_target: "input",
              action: "change->image-preview#preview" 
            } %>
        
        <% 
           preview_image = fragment.image.attached? ? fragment.image : "" 
           is_hidden = !fragment.image.attached?
        %>
        <%= image_tag preview_image, 
            class: "absolute inset-0 w-full h-full object-contain bg-slate-100 rounded-xl z-20 #{'hidden' if is_hidden}",
            data: { image_preview_target: "output" } %>

        <div class="py-8 flex flex-col items-center justify-center gap-3 text-slate-400 group-hover:text-indigo-500 transition-colors <%= 'hidden' unless is_hidden %>"
             data-image-preview_target="placeholder">
          <div class="w-16 h-16 rounded-full bg-slate-100 group-hover:bg-indigo-100 flex items-center justify-center transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
          </div>
          <span class="font-['Poppins'] font-bold text-sm">Choose File</span>
          <span class="text-xs opacity-60">PNG, JPG up to 10MB</span>
        </div>

      </div>
  </div>
  <div class="space-y-4 pt-6">
    <label class="block text-xs font-['Space_Grotesk'] font-bold text-slate-400 uppercase tracking-widest ml-1">Visibility Setting</label>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <label class="cursor-pointer group relative">
        <%= form.radio_button :visibility, :public_view, class: "peer sr-only" %>
        <div class="h-full p-6 rounded-2xl border-2 border-slate-100 bg-white text-slate-400 transition-all duration-300 ease-out flex flex-col items-center justify-center gap-2 peer-checked:border-indigo-500 peer-checked:bg-indigo-50/30 peer-checked:text-indigo-600 hover:border-indigo-200 hover:shadow-lg hover:-translate-y-1">
          <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center transition-colors duration-300 group-hover:bg-white peer-checked:bg-indigo-100 peer-checked:text-indigo-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
          </div>
          <div class="text-center"><span class="block font-['Poppins'] font-bold text-sm">Public</span><span class="block text-[10px] opacity-60 mt-0.5">Visible to everyone</span></div>
        </div>
      </label>

      <label class="cursor-pointer group relative">
        <%= form.radio_button :visibility, :private_view, class: "peer sr-only" %>
        <div class="h-full p-6 rounded-2xl border-2 border-slate-100 bg-white text-slate-400 transition-all duration-300 ease-out flex flex-col items-center justify-center gap-2 peer-checked:border-slate-800 peer-checked:bg-slate-50 peer-checked:text-slate-800 hover:border-slate-300 hover:shadow-lg hover:-translate-y-1">
          <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center transition-colors duration-300 group-hover:bg-white peer-checked:bg-slate-200 peer-checked:text-slate-800">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
          </div>
          <div class="text-center"><span class="block font-['Poppins'] font-bold text-sm">Private</span><span class="block text-[10px] opacity-60 mt-0.5">Only you can see</span></div>
        </div>
      </label>

      <label class="cursor-pointer group relative">
        <%= form.radio_button :visibility, :teammates_view, class: "peer sr-only" %>
        <div class="h-full p-6 rounded-2xl border-2 border-slate-100 bg-white text-slate-400 transition-all duration-300 ease-out flex flex-col items-center justify-center gap-2 peer-checked:border-amber-400 peer-checked:bg-amber-50 peer-checked:text-amber-700 hover:border-amber-200 hover:shadow-lg hover:-translate-y-1">
          <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center transition-colors duration-300 group-hover:bg-white peer-checked:bg-amber-100 peer-checked:text-amber-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
          </div>
          <div class="text-center"><span class="block font-['Poppins'] font-bold text-sm">Teammates</span><span class="block text-[10px] opacity-60 mt-0.5">Visible to teammates</span></div>
        </div>
      </label>
    </div>
  </div>

  <div class="pt-10 border-t border-slate-100 flex items-center gap-6">    
    <%= form.submit "DROP FRAGMENT", class: "flex-1 bg-slate-900 text-white font-['Poppins'] font-bold py-5 rounded-2xl shadow-xl shadow-slate-200 hover:bg-indigo-600 hover:shadow-indigo-200 hover:-translate-y-0.5 transition-all cursor-pointer tracking-widest text-sm" %>
  </div>

<% end %>