<div class="max-w-6xl mx-auto md:py-10 px-4 min-h-screen">
  
  <div class="text-center mb-12">
    <p class="text-xs font-bold tracking-widest text-slate-400 uppercase mb-2">Compare Studio</p>
    <h1 class="text-3xl font-['Poppins'] font-bold text-slate-800">
      <% if @base_fragment %>
        Select a Partner for <span class="text-indigo-600 border-b-2 border-indigo-200"><%= @base_fragment.title.presence || "Untitled" %></span>
      <% else %>
        Select a Fragment for <span class="text-indigo-600 border-b-2 border-indigo-200">Slot <%= @target.upcase %></span>
      <% end %>
    </h1>
  </div>

  <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
    
    <% @candidates.each do |candidate| %>
      <% 
         current_kept_id = @other_id.presence || @base_fragment&.id

         next_params = if @target == 'a'
           { fragment_a_id: candidate.id, fragment_b_id: current_kept_id }
         else
           { fragment_a_id: current_kept_id, fragment_b_id: candidate.id }
         end
      %>
      
      <%= link_to studio_comparisons_path(next_params), class: "group relative block bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border border-slate-100" do %>
        
        <div class="aspect-square bg-slate-100 relative overflow-hidden">
          <% if candidate.image.attached? %>
            <%= image_tag candidate.image, class: "w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" %>
          <% else %>
            <div class="w-full h-full flex items-center justify-center text-slate-300">
              <span class="text-xs font-bold">No Image</span>
            </div>
          <% end %>

          <div class="absolute inset-0 bg-indigo-900/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center backdrop-blur-[2px]">
            <span class="text-white font-['Poppins'] font-bold text-sm tracking-wider border border-white/30 px-4 py-2 rounded-full bg-white/10">SELECT</span>
          </div>
        </div>

        <div class="p-4">
          <h3 class="font-['Poppins'] font-bold text-slate-800 text-sm truncate"><%= candidate.title.presence || "Untitled" %></h3>
          <p class="text-[10px] text-slate-400 mt-1 font-['Space_Grotesk']">
            <%= candidate.created_at.strftime("%Y.%m.%d") %>
          </p>
        </div>
        
      <% end %>
    <% end %>

    <% if @candidates.empty? %>
      <div class="col-span-full text-center py-20 bg-slate-50 rounded-3xl border border-dashed border-slate-300">
        <p class="text-slate-400 font-bold mb-4">No other fragments found.</p>
        <%= link_to "Create New Fragment", new_fragment_path, class: "px-6 py-3 bg-slate-900 text-white rounded-full text-sm font-bold hover:bg-indigo-600 transition-colors" %>
      </div>
    <% end %>

  </div>
</div>