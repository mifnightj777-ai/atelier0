<div class="min-h-screen bg-slate-50 flex flex-col h-screen">
  
  <div class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 shrink-0 z-20">
    <div class="flex items-center gap-4">
      <%= link_to :back, class: "p-2 rounded-full hover:bg-slate-100 text-slate-400 transition-colors" do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" /></svg>
      <% end %>
      <h1 class="font-['Poppins'] font-bold text-lg text-slate-800 flex items-center gap-2">
        <span class="w-2 h-2 rounded-full bg-indigo-500 animate-pulse"></span>
        Compare Studio
      </h1>
    </div>
    
    <% if @fragment_a && @fragment_b %>
      <%= link_to studio_comparisons_path(fragment_a_id: @fragment_b.id, fragment_b_id: @fragment_a.id), class: "p-2 text-slate-400 hover:text-indigo-600 transition-colors", title: "Swap Sides" do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" /></svg>
      <% end %>
    <% end %>
  </div>

  <div class="flex-1 flex overflow-hidden">
    
    <div class="flex-1 border-r border-slate-200 bg-white relative group">
      <% if @fragment_a %>
        <div class="absolute inset-0 flex flex-col">
          <div class="flex-1 relative bg-slate-100 flex items-center justify-center overflow-hidden p-8">
            <% if @fragment_a.image.attached? %>
              <%= image_tag @fragment_a.image, class: "max-w-full max-h-full object-contain shadow-xl rounded-lg" %>
            <% else %>
              <span class="text-slate-300 font-bold">No Image</span>
            <% end %>
            <%= link_to select_comparisons_path(target: 'a', keep_id: @fragment_b&.id), class: "absolute top-4 right-4 bg-white/90 backdrop-blur px-3 py-1.5 rounded-full text-xs font-bold shadow-sm hover:bg-indigo-50 hover:text-indigo-600 transition-colors border border-slate-200" do %>
              CHANGE
            <% end %>
          </div>
          <div class="h-20 border-t border-slate-100 p-4 bg-white z-10">
            <h3 class="font-bold text-slate-800 truncate"><%= @fragment_a.title.presence || "Untitled" %></h3>
            <p class="text-xs text-slate-400 font-['Space_Grotesk']"><%= @fragment_a.created_at.strftime("%Y.%m.%d") %></p>
          </div>
        </div>
      <% else %>
        <div class="absolute inset-0 flex items-center justify-center p-8">
          <%= link_to select_comparisons_path(target: 'a', keep_id: @fragment_b&.id), class: "w-full h-full border-2 border-dashed border-slate-200 rounded-3xl flex flex-col items-center justify-center gap-4 text-slate-300 hover:border-indigo-300 hover:text-indigo-500 hover:bg-indigo-50/30 transition-all duration-300 group-hover:scale-[0.98]" do %>
            <div class="w-16 h-16 rounded-full bg-slate-50 group-hover:bg-indigo-100 flex items-center justify-center transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
            </div>
            <span class="font-['Poppins'] font-bold tracking-widest text-sm">SELECT A</span>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="flex-1 bg-white relative group">
      <% if @fragment_b %>
        <div class="absolute inset-0 flex flex-col">
          <div class="flex-1 relative bg-slate-100 flex items-center justify-center overflow-hidden p-8">
            <% if @fragment_b.image.attached? %>
              <%= image_tag @fragment_b.image, class: "max-w-full max-h-full object-contain shadow-xl rounded-lg" %>
            <% else %>
              <span class="text-slate-300 font-bold">No Image</span>
            <% end %>
            <%= link_to select_comparisons_path(target: 'b', keep_id: @fragment_a&.id), class: "absolute top-4 right-4 bg-white/90 backdrop-blur px-3 py-1.5 rounded-full text-xs font-bold shadow-sm hover:bg-indigo-50 hover:text-indigo-600 transition-colors border border-slate-200" do %>
              CHANGE
            <% end %>
          </div>
          <div class="h-20 border-t border-slate-100 p-4 bg-white z-10">
            <h3 class="font-bold text-slate-800 truncate"><%= @fragment_b.title.presence || "Untitled" %></h3>
            <p class="text-xs text-slate-400 font-['Space_Grotesk']"><%= @fragment_b.created_at.strftime("%Y.%m.%d") %></p>
          </div>
        </div>
      <% else %>
        <div class="absolute inset-0 flex items-center justify-center p-8">
          <%= link_to select_comparisons_path(target: 'b', keep_id: @fragment_a&.id), class: "w-full h-full border-2 border-dashed border-slate-200 rounded-3xl flex flex-col items-center justify-center gap-4 text-slate-300 hover:border-indigo-300 hover:text-indigo-500 hover:bg-indigo-50/30 transition-all duration-300 group-hover:scale-[0.98]" do %>
            <div class="w-16 h-16 rounded-full bg-slate-50 group-hover:bg-indigo-100 flex items-center justify-center transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
            </div>
            <span class="font-['Poppins'] font-bold tracking-widest text-sm">SELECT B</span>
          <% end %>
        </div>
      <% end %>
    </div>
    
  </div>
  
  <% if @fragment_a && @fragment_b %>
    <div class="h-48 bg-white border-t border-slate-200 p-6 z-30 shadow-[0_-4px_20px_rgba(0,0,0,0.05)]">
      <div class="max-w-3xl mx-auto h-full flex flex-col relative">
        
        <div class="flex items-center justify-between mb-2">
          <label class="text-xs font-bold text-slate-400 tracking-widest uppercase">Comparison Memo</label>
          <span id="save_status" class="text-[10px] font-bold text-indigo-500 transition-opacity duration-500 opacity-0">
            SAVED âœ“
          </span>
        </div>

        <%= form_with model: @comparison, url: comparison_path(@comparison), method: :patch, 
              local: false, 
              data: { controller: "autosave", action: "input->autosave#submit" }, 
              class: "flex-1 flex flex-col" do |f| %>
          
          <%= f.text_area :note, 
              placeholder: "Write down what you notice... (Auto saved)", 
              class: "flex-1 w-full bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 resize-none custom-scrollbar" %>
              
          <%= f.submit "Save", class: "hidden" %>
        <% end %>

      </div>
    </div>
  <% end %>

</div>