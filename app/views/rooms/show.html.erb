<div class="flex flex-col h-screen relative bg-white overflow-hidden font-['Inter']" data-controller="chat">

  <div class="fixed top-6 left-1/2 -translate-x-1/2 z-50 pointer-events-none">
    <div class="pointer-events-auto bg-white shadow-[0_4px_20px_rgba(0,0,0,0.06)] border border-slate-100 rounded-full py-1.5 pl-1.5 pr-5 flex items-center gap-1 transition-all hover:shadow-[0_8px_25px_rgba(0,0,0,0.08)]">
      
      <%= link_to rooms_path, class: "w-8 h-8 rounded-full bg-transparent hover:bg-slate-50 text-slate-400 hover:text-slate-600 flex items-center justify-center transition-colors" do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
      <% end %>

      <div class="w-px h-4 bg-slate-200 mx-1"></div>

      <% partner = (@room.sender == current_user ? @room.recipient : @room.sender) %>
      <div class="flex items-center gap-2.5">
        <div class="w-6 h-6 rounded-full bg-[#5D5FEF] text-white flex items-center justify-center font-['Poppins'] font-bold text-[10px]">
          <%= partner.username.first.upcase %>
        </div>
        <span class="font-['Poppins'] font-bold text-slate-900 text-xs leading-none pt-0.5">
          @<%= partner.username %>
        </span>
      </div>
    </div>
  </div>

  <div class="flex-1 overflow-y-auto pt-24 pb-48 px-4 z-10 custom-scrollbar" data-chat-target="messages">
    <div class="max-w-xl mx-auto flex flex-col gap-1">
      
      <div class="flex justify-center py-8 opacity-50">
        <span class="text-[10px] text-slate-400 font-['Space_Grotesk']">
          <%= @messages.first&.created_at&.strftime("%B %d, %Y at %H:%M") || "Conversation Started" %>
        </span>
      </div>

      <div id="message_list" class="w-full flex flex-col gap-1">
        <%= render @messages %>
      </div>

    </div>
  </div>

  <div class="fixed bottom-24 left-0 right-0 px-4 flex justify-center z-40 pointer-events-none">
    <div class="pointer-events-auto w-full max-w-xl bg-white rounded-full shadow-[0_12px_40px_rgba(0,0,0,0.08)] border border-slate-100 p-1.5 flex items-center gap-2 transition-all focus-within:shadow-[0_15px_50px_rgba(93,95,239,0.15)] focus-within:border-indigo-100">
      
      <%= form_with(model: [@room, @message], 
          class: "flex-1 flex items-center gap-2 w-full", 
          data: { chat_target: "form", action: "turbo:submit-end->chat#resetForm" }) do |f| %>
        
        <%= f.text_field :content, placeholder: "Message...", class: "flex-1 bg-transparent border-none px-5 py-3 text-sm font-['Inter'] text-slate-800 placeholder-slate-300 focus:ring-0 focus:outline-none h-11" %>
        
        <button type="submit" class="shrink-0 w-9 h-9 bg-[#5D5FEF] hover:bg-[#4b4dcf] text-white rounded-full flex items-center justify-center transition-all duration-200 active:scale-95 shadow-md shadow-indigo-200 mr-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 pl-0.5"><path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" /></svg>
        </button>

      <% end %>
    </div>
  </div>

</div>