<div class="flex flex-col h-screen relative bg-white overflow-hidden font-['Inter']" data-controller="chat">

  <%# --- 1. 統合ヘッダー (固定) --- %>
  <%# 上下の余白を少しだけ詰め、よりコンパクトにしました %>
  <div class="fixed top-0 left-0 right-0 z-50 px-6 pt-4 pb-3 bg-white/80 backdrop-blur-xl border-b border-slate-50 flex justify-center pointer-events-none">
    <div class="pointer-events-auto flex items-center gap-4 bg-white/60 border border-white/80 px-2 py-2 rounded-full shadow-[0_8px_30px_rgb(0,0,0,0.04)]">
      <%= link_to rooms_path, class: "w-9 h-9 rounded-full bg-white text-slate-400 hover:text-indigo-600 flex items-center justify-center transition-all hover:shadow-sm" do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
      <% end %>
      <div class="w-px h-4 bg-slate-200/50 mx-0.5"></div>
      <% partner = (@room.sender == current_user ? @room.recipient : @room.sender) %>
      <div class="flex items-center gap-3 pr-5">
        <div class="w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center font-['Poppins'] font-bold text-[11px] shadow-lg">
          <%= partner.username.first.upcase %>
        </div>
        <div class="flex flex-col">
          <span class="font-['Poppins'] font-bold text-slate-900 text-xs tracking-wide">@<%= partner.username %></span>
          <span class="text-[8px] text-indigo-400 font-['Space_Grotesk'] font-bold tracking-widest uppercase leading-none mt-0.5">Dialogue</span>
        </div>
      </div>
    </div>
  </div>

  <%# --- 2. メッセージエリア (さらに位置をアップ) --- %>
  <%# pt-20 にすることで、ヘッダーのすぐ真下からメッセージが表示されます %>
  <div class="flex-1 overflow-y-auto pt-20 pb-48 px-4 z-10 custom-scrollbar" data-chat-target="messages">
    <div class="max-w-xl mx-auto flex flex-col">
      
      <%# ログの開始地点（一番上）に余白がつかないよう mt-0 に設定 %>
      <div id="message_list" class="w-full flex flex-col gap-1 mt-0">
        <%= render @messages %>
      </div>

      <%# 過去ログへの境界線（下部へ移動） %>
      <div class="flex flex-col items-center py-12 opacity-20">
        <span class="text-[8px] text-slate-400 font-['Space_Grotesk'] tracking-[0.4em] uppercase">Beginning of Dialogue</span>
        <div class="w-px h-12 bg-gradient-to-b from-slate-300 to-transparent mt-4"></div>
      </div>

    </div>
  </div>

  <%# --- 3. 入力エリア (固定) --- %>
  <div class="fixed bottom-10 left-0 right-0 px-4 flex justify-center z-40 pointer-events-none">
    <div class="pointer-events-auto w-full max-w-xl bg-white/90 backdrop-blur-xl rounded-[30px] shadow-[0_25px_50px_rgba(0,0,0,0.1)] border border-slate-100 p-2 flex items-center gap-2">
      <%= form_with(model: [@room, @message], 
          class: "flex-1 flex items-center gap-2 w-full", 
          data: { chat_target: "form", action: "turbo:submit-end->chat#resetForm" }) do |f| %>
        
        <%# ▼変更点: focus:outline-none を追加しました %>
        <%= f.text_field :content, 
            placeholder: "Type your message...", 
            class: "flex-1 bg-transparent border-none px-5 py-3 text-sm font-['Inter'] text-slate-700 focus:ring-0 focus:outline-none h-12 placeholder-slate-400" %>
            
        <button type="submit" class="group shrink-0 w-11 h-11 bg-slate-900 text-white rounded-full flex items-center justify-center transition-all hover:bg-indigo-600 active:scale-90">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 ml-0.5"><path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" /></svg>
        </button>
      <% end %>
    </div>


</div>