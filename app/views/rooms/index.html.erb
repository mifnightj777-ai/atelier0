<div class="max-w-3xl mx-auto py-12 px-6">
  
  <%# --- 1. ヘッダー (Mailboxと完全に統一) --- %>
  <div class="flex items-end justify-between mb-12">
    <div>
      <h1 class="font-['Poppins'] text-4xl font-bold text-slate-900 tracking-tight">Messages.</h1>
      <p class="text-slate-400 text-xs mt-2 font-['Space_Grotesk'] tracking-widest uppercase">
        Ongoing Dialogue / <%= @rooms.count %> Active
      </p>
    </div>
  </div>

  <%# --- 2. チャットルームリスト --- %>
  <div class="space-y-4">
    <% @rooms.each do |room| %>
      <% partner = (room.sender == current_user ? room.recipient : room.sender) %>
      <% unread = room.has_unread_messages?(current_user) %>
      <% last_msg = room.messages.last %>
      
      <%= link_to room_path(room), class: "group block bg-white rounded-[30px] border border-slate-100 shadow-[0_2px_15px_rgb(0,0,0,0.02)] hover:shadow-[0_10px_40px_rgb(0,0,0,0.06)] hover:border-indigo-100 transition-all duration-500 overflow-hidden" do %>
        
        <div class="p-6 flex items-center gap-5 hover:bg-slate-50/50 transition-colors relative">
          
          <%# 未読バッジ %>
          <% if unread %>
            <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1.5 h-12 bg-indigo-600 rounded-r-full shadow-[4px_0_15px_rgba(79,70,229,0.4)]"></div>
          <% end %>

          <%# アイコン (Mailboxと同じ14x14の角丸2xl) %>
          <div class="shrink-0 w-14 h-14 rounded-2xl <%= unread ? 'bg-indigo-600 text-white shadow-indigo-200 shadow-lg' : 'bg-slate-50 text-slate-400 border border-slate-100' %> flex items-center justify-center font-['Poppins'] font-bold text-xl transition-all duration-300 group-hover:scale-105">
            <%= partner.username.first.upcase %>
          </div>

          <%# テキストエリア %>
          <div class="flex-1 min-w-0 pr-4">
            <div class="flex justify-between items-start mb-1">
              <span class="font-['Poppins'] font-bold text-slate-900 text-lg">
                @<%= partner.username %>
              </span>
              <span class="text-[10px] text-slate-300 font-['Space_Grotesk'] tracking-widest uppercase mt-1.5">
                <%= time_ago_in_words(last_msg&.created_at || room.updated_at) %> ago
              </span>
            </div>
            
            <%# メッセージプレビュー %>
            <p class="text-sm font-medium <%= unread ? 'text-indigo-600' : 'text-slate-500' %> truncate leading-relaxed">
              <% if last_msg %>
                <%= last_msg.user == current_user ? "You: " : "" %><%= last_msg.content %>
              <% else %>
                <span class="italic opacity-60">No messages yet.</span>
              <% end %>
            </p>
          </div>

          <%# 矢印アイコン (Mailboxと統一) %>
          <div class="text-slate-200 group-hover:text-indigo-400 group-hover:translate-x-1 transition-all duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
          </div>

        </div>
      <% end %>
    <% end %>

    <%# --- 3. 空の状態 (Mailboxと統一) --- %>
    <% if @rooms.empty? %>
      <div class="py-24 text-center">
        <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" class="w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 8.511c.115.117.202.247.25.378a2.5 2.5 0 11-4.95 0c.048-.13.135-.26.25-.378m4.45 0a4.5 4.5 0 00-4.45 0m4.45 0c.115.117.202.247.25.378a2.5 2.5 0 11-4.95 0c.048-.13.135-.26.25-.378m-4.45 0a4.5 4.5 0 00-4.45 0" /></svg>
        </div>
        <p class="font-['Poppins'] text-slate-400 font-bold">No active messages.</p>
        <p class="text-xs text-slate-300 mt-2 font-['Inter']">Accepted letters will appear here.</p>
      </div>
    <% end %>
  </div>
</div>